<!DOCTYPE html>
<html>
  <head>
    <title>Compare Grocery Prices</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  </head>

  <body>
  <% if user_signed_in? %>
    <div>Signed in as... <%= current_user.email %>
      (<%= link_to'Sign out', destroy_user_session_path,:method => :delete %>)</div>

    <% @profileList = Profile.all %>
    <% profilePresent = false %>

    <% if current_user.admin? == false %>
      <% for profile in @profileList %>
        <% if profile.user_id == current_user.id %>
          <% profilePresent = true %>
          <%= link_to 'Update Your Profile', edit_profile_path(profile.id) %>
          <% break %>
        <% end %>
      <% end %>

      <% if profilePresent == false %>
        <%= link_to 'Update Your Profile', {:controller => "profiles", :action => "new", :user_id => current_user.id} %>
      <% end %>
    <% end %>

    </br>
    <%= link_to 'Home', {:controller => "home", :action => "Index" } %>
    <%= link_to 'Previous Orders', {:controller => "baskets", :action => "index" } %>
    <% else %>
    <%= link_to'Register', new_user_registration_path %> or
    <%= link_to'Sign in', new_user_session_path %>
    <%= link_to "Sign in with Facebook", user_facebook_omniauth_authorize_path %>

    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v5.0&appId=578492609360424&autoLogAppEvents=1"></script>

    <div class="fb-login-button" data-width="" data-size="large" data-button-type="login_with" data-auto-logout-link="false" data-use-continue-as="false"></div>

    <% session.delete(:order_id) %>
    <%session.delete(current_user) %>

  <% end %>
    <%= yield %>


  </body>
</html>
